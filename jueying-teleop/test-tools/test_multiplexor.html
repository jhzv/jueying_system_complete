<!DOCTYPE html>
<html>
<head>
    <title>Test Multiplexor</title>
    <style>
        body { 
            font-family: monospace; 
            background: #000; 
            color: #0f0; 
            padding: 20px; 
        }
        button { 
            background: #0f0; 
            color: #000; 
            padding: 10px; 
            margin: 5px; 
            border: none; 
            cursor: pointer; 
        }
        #log { 
            background: #111; 
            padding: 10px; 
            height: 400px; 
            overflow-y: auto; 
            border: 1px solid #0f0; 
        }
    </style>
</head>
<body>
    <h2>ðŸ”Œ Test Multiplexor Directo</h2>
    
    <div>
        <button onclick="testMultiplexor()">Conectar a Multiplexor</button>
        <button onclick="testRosbridgeDirect()">Conectar Directo a Rosbridge</button>
        <button onclick="clearLog()">Limpiar</button>
    </div>
    
    <h3>Log:</h3>
    <div id="log"></div>

    <script>
        function log(msg) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${msg}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testMultiplexor() {
            log('ðŸ”Œ Conectando a MULTIPLEXOR (puerto 8080)...');
            const ws = new WebSocket('ws://192.168.1.103:8080');
            
            ws.onopen = () => {
                log('âœ… MULTIPLEXOR: Conectado!');
                
                // Enviar auth
                ws.send(JSON.stringify({
                    type: 'auth',
                    token: 'test-token'
                }));
                log('ðŸ“¤ MULTIPLEXOR: Auth enviado');
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                log(`ðŸ“¨ MULTIPLEXOR: ${data.type} - ${JSON.stringify(data).substring(0,100)}`);
                
                if (data.type === 'ros_connection') {
                    if (data.connected) {
                        log('âœ… MULTIPLEXOR reporta: ROS CONECTADO!');
                    } else {
                        log('âŒ MULTIPLEXOR reporta: ROS DESCONECTADO');
                    }
                }
            };
            
            ws.onerror = (error) => {
                log('âŒ MULTIPLEXOR: Error de conexiÃ³n');
                console.error(error);
            };
            
            ws.onclose = () => {
                log('ðŸ”Œ MULTIPLEXOR: Desconectado');
            };
        }

        function testRosbridgeDirect() {
            log('ðŸ”Œ Conectando DIRECTO a ROSBRIDGE (puerto 9090)...');
            const ws = new WebSocket('ws://192.168.1.103:9090');
            
            ws.onopen = () => {
                log('âœ… ROSBRIDGE: Conectado directamente!');
                
                // Subscribirse a un tÃ³pico
                ws.send(JSON.stringify({
                    op: 'subscribe',
                    topic: '/rosout'
                }));
                log('ðŸ“¤ ROSBRIDGE: Subscrito a /rosout');
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                log(`ðŸ“¨ ROSBRIDGE: ${data.op || 'mensaje'}`);
            };
            
            ws.onerror = (error) => {
                log('âŒ ROSBRIDGE: Error de conexiÃ³n');
                console.error(error);
            };
            
            ws.onclose = () => {
                log('ðŸ”Œ ROSBRIDGE: Desconectado');
            };
        }

        log('âœ… Sistema listo. Presiona un botÃ³n para probar.');
    </script>
</body>
</html>
